#include <stdio.h>
#include <string.h>
#include <ctype.h>

#define N 50

char stack[N];
int top = -1;

void push(char c) {
    if (top == N - 1) {
        printf("Stack overflow\n");
        return;
    }
    stack[++top] = c;
}

char pop() {
    if (top == -1) {
        printf("Stack underflow\n");
        return '\0';
    }
    return stack[top--];
}

int order(char o) {
    if (o == '^') return 3;
    else if (o == '*' || o == '/') return 2;
    else if (o == '+' || o == '-') return 1;
    else return 0;
}

int main() {
    char exp[N];
    char output[N];
    int idx = -1;

    printf("Enter your expression: ");
    scanf("%s", exp);

    for (int i = 0; i < (int)strlen(exp); i++) {
        char e = exp[i];

        if (isalnum(e)) {
            output[++idx] = e;
        } 
        else if (e == '(') {
            push(e);
        } 
        else if (e == ')') {
            while (top != -1 && stack[top] != '(') {
                output[++idx] = pop();
            }
            if (top != -1 && stack[top] == '(')
                pop();
        } 
        else {
            while (top != -1 && stack[top] != '(' &&
                  ((e == '^' && order(e) < order(stack[top])) ||
                   (e != '^' && order(e) <= order(stack[top])))) {
                output[++idx] = pop();
            }
            push(e);
        }
    }

    while (top != -1) {
        output[++idx] = pop();
    }

    output[++idx] = '\0';
    printf("%s\n", output);
    return 0;
}
